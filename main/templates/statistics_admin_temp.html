{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>전라남도교육청 : 학교민주주의 지수</title>
    <link rel="stylesheet" href="{% static 'main/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/styles.css?v=2' %}">
    <link rel="stylesheet" href="{% static 'main/css/base.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<header id="header">
    <section class="header">
        <a class="sta" href="/jns/main"><img src="/static/main/images/logo.png" alt="전라남도 교육청 로고" /></a>
        <nav class="jn">
            <ul>
                <li class=""><a href="/jns/about1">학교민주주의 정책 이해</a></li>
                <li class=""><a href="/jns/about2">학교민주주의 지수 안내</a></li>
                <li class=""><a href="/jns/post">공지사항</a></li>
                <li class=""><a href="/jns/file">자료실</a></li>
                <li class=""><a href="/jns/admin">학교관리자</a></li>
            </ul>
        </nav>
        <img src="/static/main/images/sta04.png" alt="전남교육 아이좋아 로고" class="sta04">
    </section>
</header>

<h1>응답합 출력</h1>
<ul>
    {% for response in responses %}
        <li>문항 {{ forloop.counter }}: {{ response }}</li>
    {% endfor %}
</ul>

<h1>평균 출력</h1>
<ul>
    <li>총 평균 점수: {{ average_response }}</li>
</ul>

<h1>section별 평균 출력</h1>
<ul>
    <li>총 평균 점수: {{ average_section_response }}</li>
</ul>

<h1>전체 평균 출력</h1>
<ul>
    <li>총 평균 점수: {{ average_total_response }}</li>
</ul>

<!-- 그래프 그리기 -->
<canvas id="student_question_canvas" width="400" height="200"></canvas>
<canvas id="student_section_canvas" width="400" height="200"></canvas>
<canvas id="student_total_canvas" width="400" height="200"></canvas>

<footer id="footer">
    <section class="footer">
        <a class="sta"><img src="/static/main/images/logo.png" alt="전라남도 교육청" /></a>
        <p class="copy">
            (58564) 전라남도 무안군 삼향읍 어진누리길 10
        </p>
    </section>
</footer>

<script>
    // 첫 번째 그래프 (문항별 평균 점수)
    var labels = Array.from({length: {{ average_response|length }}}, (v, k) => "문항 "+ (k+1));
    var data = JSON.parse('{{ average_response|safe }}');

    console.log("평균 응답 데이터:", {{ average_response|safe }});

    var ctx = document.getElementById('student_question_canvas').getContext('2d');
    var student_canvas = new Chart(ctx, {
        type: 'bar', //막대그래프 (그래프 타입)
        data: {
            labels : labels,
            datasets: [{
                label: '문항별 평균 점수',
                data: data, 
                backgroundColor: 'rgba(75, 192, 192, 0.2)', //막대 색
                borderColor: 'rgba(75, 192, 192, 1)', //막대 테두리 색
                borderWidth: 1
            }]
        }, 
        options: {
            scales: {
                y: {
                    beginAtZero: true, 
                    max: 5
                }
            }
        }
    });

    // 두 번째 그래프 (영역별 평균 점수)
    var sectionLabels = ["학교문화", "학교구조", "민주시민교육"];
    var sectionData = JSON.parse('{{ average_section_response|safe }}');

    var ctx2 = document.getElementById('student_section_canvas').getContext('2d');
    var student_section_canvas = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: sectionLabels,
            datasets: [{
                label: '영역별 평균 점수',
                data: sectionData,
                backgroundColor: 'rgba(153, 102, 255, 0.2)', 
                borderColor: 'rgba(153, 102, 255, 1)', 
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5
                }
            }
        }
    });

    // 세 번째 그래프 (총 평균 점수)
    var totalLabels = ["총 평균 점수"];
    var totalData = JSON.parse('{{ average_total_response|safe }}');

    var ctx3 = document.getElementById('student_total_canvas').getContext('2d');
    var student_total_canvas = new Chart(ctx3, {
        type: 'bar',
        data: {
            labels: totalLabels,
            datasets: [{
                label: '총 평균 점수',
                data: totalData,
                backgroundColor: 'rgba(255, 99, 132, 0.2)', 
                borderColor: 'rgba(255, 99, 132, 1)', 
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5
                }
            }
        }
    });


</script>

</body>
</html>